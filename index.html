<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Custom Keyring Reservation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#FEF7FC; --fg:#F08FB5; --card:#fff0f5; }
    body { background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Arial,sans-serif; margin:0; padding:24px; text-align:center; }
    h1 { margin:0 0 8px; } .subtitle{margin:0 0 24px; opacity:.85;}
    .step{background:var(--card); border:2px dashed var(--fg); border-radius:16px; padding:16px; margin:0 auto 16px; max-width:820px;}
    .grid{display:grid; grid-template-columns:repeat(auto-fit, minmax(160px,1fr)); gap:12px; margin-top:12px;}
    .option{border:2px solid transparent; border-radius:12px; padding:10px; cursor:pointer; background:#fff; color:inherit;}
    .option.selected{border-color:var(--fg);} .option img{width:120px; height:120px; object-fit:cover; border-radius:12px; display:block; margin:0 auto 8px;}
    input[type="text"], .text{width:min(560px,90%); padding:10px 12px; border:1px solid #ddd; border-radius:10px; color:inherit;}
    .row{margin:10px 0;} .actions{margin-top:12px;}
    button{background:var(--fg); color:#fff; border:none; border-radius:10px; padding:10px 16px; cursor:pointer;}
    button:disabled{opacity:.5; cursor:default;}
    .hidden{display:none!important;} .error { color:#b00020; margin-top:8px; }
  </style>
</head>
<body>
  <h1>Custom Keyring Reservation</h1>
  <p class="subtitle">Fill in your info, choose your options, and get your reservation number.</p>

  <!-- Step 1 -->
  <div class="step" id="s1">
    <h2>Step 1: Personal Information (required)</h2>
    <div class="row"><input id="name" type="text" placeholder="Name" /></div>
    <div class="row"><input id="phone" type="text" placeholder="Phone Number" /></div>
    <div class="row"><input id="xid" type="text" placeholder="X ID" /></div>
    <div class="row">
      <label><input id="privacy" type="checkbox" /> I agree to provide my personal information (required)</label>
    </div>
    <div class="actions"><button onclick="go(2)">Next</button></div>
  </div>

  <!-- Step 2 -->
  <div class="step hidden" id="s2">
    <h2>Step 2: Choose Keyring Shape</h2>
    <div class="grid">
      <div class="option" data-value="Heart" onclick="pick('shape', this)">
        <img src="https://via.placeholder.com/150?text=Heart" alt="Heart" /><div>Heart</div>
      </div>
      <div class="option" data-value="Round" onclick="pick('shape', this)">
        <img src="https://via.placeholder.com/150?text=Round" alt="Round" /><div>Round</div>
      </div>
      <div class="option" data-value="Rectangle" onclick="pick('shape', this)">
        <img src="https://via.placeholder.com/150?text=Rectangle" alt="Rectangle" /><div>Rectangle</div>
      </div>
    </div>
    <div class="actions"><button onclick="back(1)">Back</button><button onclick="go(3)">Next</button></div>
  </div>

  <!-- Step 3 -->
  <div class="step hidden" id="s3">
    <h2>Step 3: Choose Fabric</h2>
    <div class="grid">
      <div class="option" data-value="Satin" onclick="pick('fabric', this)">
        <img src="https://via.placeholder.com/150?text=Satin" alt="Satin" /><div>Satin</div>
      </div>
      <div class="option" data-value="Leopard" onclick="pick('fabric', this)">
        <img src="https://via.placeholder.com/150?text=Leopard" alt="Leopard" /><div>Leopard</div>
      </div>
    </div>
    <div class="actions"><button onclick="back(2)">Back</button><button onclick="go(4)">Next</button></div>
  </div>

  <!-- Step 4 -->
  <div class="step hidden" id="s4">
    <h2>Step 4: Choose Lace</h2>
    <div class="grid">
      <div class="option" data-value="Lace" onclick="pick('lace', this)">
        <img src="https://via.placeholder.com/150?text=Lace" alt="Lace" /><div>Lace</div>
      </div>
      <div class="option" data-value="Fabric Lace" onclick="pick('lace', this)">
        <img src="https://via.placeholder.com/150?text=Fabric+Lace" alt="Fabric Lace" /><div>Fabric Lace</div>
      </div>
    </div>
    <div class="actions"><button onclick="back(3)">Back</button><button onclick="go(5)">Next</button></div>
  </div>

  <!-- Step 5 -->
  <div class="step hidden" id="s5">
    <h2>Step 5: Cubic Keyword</h2>
    <div class="row"><input id="keyword" type="text" class="text" placeholder='e.g., "Give me LOVE"' /></div>
    <div class="actions"><button onclick="back(4)">Back</button><button onclick="go(6)">Next</button></div>
  </div>

  <!-- Step 6 -->
  <div class="step hidden" id="s6">
    <h2>Step 6: Cubic Color</h2>
    <div class="grid">
      <div class="option" data-value="Black" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/000000/FFFFFF?text=Black" alt="Black" /><div>Black</div>
      </div>
      <div class="option" data-value="Clear" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/FFFFFF/000000?text=Clear" alt="Clear" /><div>Clear</div>
      </div>
      <div class="option" data-value="Pink" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/FFC0CB/000000?text=Pink" alt="Pink" /><div>Pink</div>
      </div>
      <div class="option" data-value="Sky Blue" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/87CEEB/000000?text=Sky+Blue" alt="Sky Blue" /><div>Sky Blue</div>
      </div>
    </div>
    <div class="actions"><button onclick="back(5)">Back</button><button onclick="go(7)">Next</button></div>
  </div>

  <!-- Step 7 -->
  <div class="step hidden" id="s7">
    <h2>Step 7: Review & Submit</h2>
    <div id="summary"></div>
    <div class="error" id="submitError" style="display:none;"></div>
    <div class="actions" style="margin-top:12px;">
      <button onclick="back(6)">Back</button>
      <button id="submitBtn" onclick="submitForm()">Confirm & Submit</button>
    </div>
  </div>

  <!-- Step 8 -->
  <div class="step hidden" id="s8">
    <h2>Thank you!</h2>
    <p id="doneText"></p>
  </div>

  <script>
    // ‚Üê Ïó¨Í∏∞ Ìïú Ï§ÑÎßå ÎÑ§ "Web app URL"Î°ú Î∞îÍæ∏Î©¥ ÏôÑÎ£å!
    const WEB_APP_URL = 'Ïó¨Í∏∞Ïóê Î∂ôÏó¨ÎÑ£Í∏∞';

    const state = { name:'', phone:'', xid:'', privacy:false, shape:'', fabric:'', lace:'', keyword:'', color:'' };

    function go(step){
      if(step===2){
        state.name = document.getElementById('name').value.trim();
        state.phone = document.getElementById('phone').value.trim();
        state.xid = document.getElementById('xid').value.trim();
        state.privacy = document.getElementById('privacy').checked;
        if(!state.name || !state.phone || !state.xid || !state.privacy){
          alert('Please complete all required fields and check the privacy agreement.');
          return;
        }
      }
      if(step===7){
        state.keyword = document.getElementById('keyword').value.trim();
        if(!state.shape || !state.fabric || !state.lace || !state.color || !state.keyword){
          alert('Please complete all selections.');
          return;
        }
        renderSummary();
      }
      show(step);
    }
    function back(step){ show(step); }
    function show(step){ for(let i=1;i<=8;i++){ const el=document.getElementById('s'+i); if(el) el.classList.toggle('hidden', i!==step); } }
    function pick(key, el){ const parent=el.parentElement; [...parent.querySelectorAll('.option')].forEach(o=>o.classList.remove('selected')); el.classList.add('selected'); state[key]=el.dataset.value; }
    function renderSummary(){
      document.getElementById('summary').innerHTML = `
        <div><b>Shape:</b> ${state.shape}</div>
        <div><b>Fabric:</b> ${state.fabric}</div>
        <div><b>Lace:</b> ${state.lace}</div>
        <div><b>Cubic Keyword:</b> "${state.keyword}"</div>
        <div><b>Cubic Color:</b> ${state.color}</div>
      `;
      document.getElementById('submitError').style.display='none';
      document.getElementById('submitError').textContent='';
    }

    // üîë FormData(Ìó§Îçî ÏóÜÏùå)Î°ú Î≥¥ÎÇ¥ CORS Î¨∏Ï†ú ÏóÜÏù¥ ÎèôÏûë
    async function submitForm(){
      const btn=document.getElementById('submitBtn');
      const errBox=document.getElementById('submitError');
      btn.disabled=true; btn.textContent='Submitting...';
      errBox.style.display='none'; errBox.textContent='';

      try{
        const fd = new FormData();
        fd.append('name', state.name);
        fd.append('phone', state.phone);
        fd.append('xid', state.xid);
        fd.append('privacy', state.privacy ? 'Y' : 'N');
        fd.append('shape', state.shape);
        fd.append('fabric', state.fabric);
        fd.append('lace', state.lace);
        fd.append('keyword', state.keyword);
        fd.append('color', state.color);
        fd.append('userAgent', navigator.userAgent);

        const res = await fetch(WEB_APP_URL, { method:'POST', body: fd });
        const text = await res.text();
        let data; try { data = JSON.parse(text); } catch(e){ data = null; }

        if(!res.ok || !data || data.ok !== true){
          const reason = (data && (data.error || JSON.stringify(data))) || text || (`HTTP ${res.status}`);
          throw new Error(reason);
        }

        document.getElementById('doneText').textContent =
          `${state.name}, your reservation number is: ${data.reservationNumber}`;
        show(8);

      }catch(err){
        errBox.textContent = 'Submit failed: ' + err.message;
        errBox.style.display='block';
        btn.disabled=false; btn.textContent='Confirm & Submit';
      }
    }

    show(1);
  </script>
</body>
</html>

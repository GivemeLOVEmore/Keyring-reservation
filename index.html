<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Give me LOVE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- 외부 CSS (기존 파일) -->
  <link rel="stylesheet" href="style.css" />

  <!-- Google Fonts: Moirai One (Step 숫자 전용) -->
  <link href="https://fonts.googleapis.com/css2?family=Moirai+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Moo+Lah+Lah&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dangrek&display=swap" rel="stylesheet">
</head>
  
<body>
  <h1>Give me LOVE</h1>
  <p class="subtitle">Make a custom filled with love.</p>

  <!-- Step 1 -->
  <div class="step" id="s1">
    <h2>Step 1: Personal Information (required)</h2>
    <div class="row"><input id="name" type="text" placeholder="Name" /></div>
    <div class="row"><input id="phone" type="text" placeholder="Phone Number" /></div>
    <div class="row"><input id="xid" type="text" placeholder="SNS ID" /></div>
    <div class="row">
      <label><input id="privacy" type="checkbox" /> I agree to provide my personal information (required)</label>
    </div>
    <div class="actions">
      <span></span>
      <button class="circle-btn next" onclick="go(2)" aria-label="Next">→<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="step hidden" id="s2">
    <h2>Step 2: Pick your favorite keyring shape</h2>
    <div class="grid">
      <div class="option" data-value="Heart" onclick="pick('shape', this)">
        <img src="images/shape-heart.png?v=2" alt="Heart" /><div>Heart</div>
      </div>
      <div class="option" data-value="Round" onclick="pick('shape', this)">
        <img src="images/shape-round.png?v=2" alt="Round" /><div>Round</div>
      </div>
      <div class="option" data-value="Rectangle" onclick="pick('shape', this)">
        <img src="images/shape-rectangle.png?v=2" alt="Rectangle" /><div>Rectangle</div>
      </div>
    </div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(1)" aria-label="Back">←<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(3)" aria-label="Next">→<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 3 -->
  <div class="step hidden" id="s3">
    <h2>Step 3: Select your fabric style</h2>

    <!-- 원단 선택 -->
    <div class="grid" id="fabricGrid">
      <div class="option" onclick="selectFabric('Satin', this)">
        <img src="images/fabricstyle-satin.jpg?v=2" alt="Satin" /><div>Satin</div>
      </div>
      <div class="option" onclick="selectFabric('Leopard', this)">
        <img src="images/leopard-fabric.jpg?v=2" alt="Leopard" /><div>Leopard</div>
      </div>
    </div>

    <!-- 원단 색상칩 (선택 후 노출) -->
    <div id="fabricColors" class="color-chips hidden" role="radiogroup" aria-label="Fabric colors"></div>

    <!-- 네비게이션 -->
    <div class="actions">
      <button class="circle-btn back" onclick="back(2)" aria-label="Back">←<span class="sr-only">Back</span></button>
      <div id="fabricSelectionNote" class="step-selection-note"></div>
      <button class="circle-btn next" id="nextS3" onclick="go(4)" aria-label="Next" disabled>
        →<span class="sr-only">Next</span>
      </button>
    </div>
  </div>

  <!-- Step 4 -->
  <div class="step hidden" id="s4">
    <h2>Step 4: Add a touch of lace</h2>

    <!-- 레이스 타입 -->
    <div class="grid" id="laceGrid">
      <div class="option" onclick="selectLace('Lace', this)">
        <img src="images/lace.png?v=2" alt="Lace" /><div>Lace</div>
      </div>
      <div class="option" onclick="selectLace('FabricLace', this)">
        <img src="images/fabricstyle-satin.jpg?v=2" alt="Fabric Lace" /><div>Fabric Lace</div>
      </div>
    </div>

    <!-- 레이스 색상칩 (선택 후 노출) -->
    <div id="laceColors" class="color-chips hidden" role="radiogroup" aria-label="Lace colors"></div>

    <!-- 네비게이션 -->
    <div class="actions">
      <button class="circle-btn back" onclick="back(3)" aria-label="Back">←<span class="sr-only">Back</span></button>
      <div id="laceSelectionNote" class="step-selection-note"></div>
      <button class="circle-btn next" id="nextS4" onclick="go(5)" aria-label="Next" disabled>
        →<span class="sr-only">Next</span>
      </button>
    </div>
  </div>

  <!-- Step 5 -->
  <div class="step hidden" id="s5">
    <h2>Step 5: Type in your custom keyword</h2>
    <div class="row"><input id="keyword" type="text" class="text" placeholder='e.g., "Give me LOVE"' /></div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(4)" aria-label="Back">←<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(6)" aria-label="Next">→<span class="sr-only">Next</span></button>
    </div>
  </div>

  <div class="step hidden" id="s6">
  <h2>Step 6: Choose your cubic color</h2>
  <div class="grid" id="cubicGrid">
    <div class="option" data-value="Clear" onclick="pick('cubicColor', this)">
      <img src="images/cubic-clear.png?v=2" alt="Clear" /><div>Clear</div>
    </div>
    <div class="option" data-value="Black" onclick="pick('cubicColor', this)">
      <img src="images/cubic-black.png?v=2" alt="Black" /><div>Black</div>
    </div>
    <div class="option" data-value="Pink" onclick="pick('cubicColor', this)">
      <img src="images/cubic-pink.png?v=2" alt="Pink" /><div>Pink</div>
    </div>
    <div class="option" data-value="Sky Blue" onclick="pick('cubicColor', this)">
      <img src="images/cubic-blue.png?v=2" alt="Sky Blue" /><div>Sky Blue</div>
    </div>
  </div>
  <div class="actions">
    <button class="circle-btn back" onclick="back(5)" aria-label="Back">←<span class="sr-only">Back</span></button>
    <button class="circle-btn next" onclick="go(7)" aria-label="Next">→<span class="sr-only">Next</span></button>
  </div>
</div>

  <!-- Step 7 -->
  <div class="step hidden" id="s7">
    <h2>Step 7: Review your choices and confirm</h2>
    <div id="summary"></div>
    <div class="error" id="submitError" style="display:none;"></div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(6)" aria-label="Back">←<span class="sr-only">Back</span></button>
      <button class="circle-btn next" id="submitBtn" onclick="submitForm()" aria-label="Submit">✓<span class="sr-only">Submit</span></button>
    </div>
  </div>

  <!-- Step 8 -->
  <div class="step hidden" id="s8">
    <h2>Your reservation is complete – thank you!</h2>
    <p id="doneText"></p>
    <div id="receiptFinal" class="receipt"></div>
  </div>

  <script>
    // ✅ 네가 준 Web App URL (바로 동작)
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzDmUw-P8BeIdqE9eSW9uMGTJtQxuUnzTrmIA9DjRhAaVZ_2SA7sov_8wjfNL-HwjFj8Q/exec';
    const LOGO_URL = "images/logo.png"; // ← 실제 로고 이미지 경로 넣기
    const THANKS_HEADER = "Have a day full of love.";
    // 상태
    const state = {
      name:'', phone:'', xid:'', privacy:false,
      shape:'',
      // Step3
      fabric:'', fabricEn:'', fabricColor:'', fabricColorId:'',
      // Step4
      laceType:'', lace:'', laceColor:'', laceColorId:'',
      // Step5/6
      keyword:'', cubicColor:''
    };

    /* 공통 내비 */
    function show(step){ for(let i=1;i<=8;i++){ const el=document.getElementById('s'+i); if(el) el.classList.toggle('hidden', i!==step); } }
    function back(step){ show(step); }
    function pick(key, el){
      const parent=el.parentElement;
      [...parent.querySelectorAll('.option')].forEach(o=>o.classList.remove('selected'));
      el.classList.add('selected');
      state[key]=el.dataset.value;
    }

    function go(step){
      if(step===2){
        state.name = document.getElementById('name').value.trim();
        state.phone = document.getElementById('phone').value.trim();
        state.xid = document.getElementById('xid').value.trim();
        state.privacy = document.getElementById('privacy').checked;
        if(!state.name || !state.phone || !state.xid || !state.privacy){
          alert('Please complete all required fields and check the privacy agreement.');
          return;
        }
      }
      if(step===7){
        // Step7 들어가기 전 검증(필요 항목 확인)
        state.keyword = document.getElementById('keyword').value.trim();
        if(!state.shape || !state.fabric || !state.fabricColor || !state.lace || !state.laceColor || !state.keyword || !state.cubicColor){
          alert('Please complete all selections.');
          return;
        }
        renderReceipt({
          name: state.name,
          date: new Date(),
          shape: state.shape,
          fabric: state.fabricEn||state.fabric,
          fabricColor: state.fabricColor,
          lace: state.lace,
          laceColor: state.laceColor,
          keyword: state.keyword,
          cubicColor: state.cubicColor
        });
        
        renderSummary();
      }
      // Step3/4에서의 추가 제어는 아래 래핑 go에서 처리
      _goWrapped(step);
    }

    // 원래 show 호출
    function _goWrapped(step){ show(step); }

    /* ===== Step 3: 설정/로직 ===== */
    const FABRIC_CONFIG = {
      Satin: {
        id: 'Satin', labelEn: 'Satin',
        colors: [
          { id: 'white', labelEn: 'White', imageUrl: 'images/satin-white.jpg?v=2', inStock: true },
          { id: 'black_satin', labelEn: 'Black', imageUrl: 'images/satin-black.jpg?v=2', inStock: true },
          { id: 'skyblue', labelEn: 'Sky Blue', imageUrl: 'images/satin-skyblue.jpg?v=2', inStock: true },
          { id: 'lpink', labelEn: 'Light Pink', imageUrl: 'images/satin-lightpink.jpg?v=2', inStock: true }
        ]
      },
      Leopard: {
        id: 'Leopard', labelEn: 'Leopard',
        colors: [
          { id: 'default', labelEn: 'Default', imageUrl: 'images/leopard-fabric.jpg?v=2', inStock: true },
          { id: 'pink',    labelEn: 'Pink',    imageUrl: 'images/leopard-pink.jpg?v=2', inStock: true },
          { id: 'khaki',   labelEn: 'Khaki',   imageUrl: 'images/leopard-khaki.jpg?v=2', inStock: true }
        ]
      }
    };

 function selectFabric(key, el){
  // ① 먼저 정리
  resetChipsWrap('fabricGrid','fabricColors');

  // ② 상태/선택 표시
  const grid = document.getElementById('fabricGrid');
  [...grid.querySelectorAll('.option')].forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');

  state.fabric    = key;
  state.fabricEn  = FABRIC_CONFIG[key]?.labelEn || key;
  state.fabricColor   = '';
  state.fabricColorId = '';

  // ③ 칩 HTML 렌더만 (표시/숨김 X)
  renderFabricChips(key);

  // ④ 선택 카드 오른쪽으로 패널 부착 + 표시
  const panel = document.getElementById('fabricColors');
  attachChipsRight(el, panel);

  updateFabricSelectionNote();
  refreshStep3Controls();
  }

    function renderFabricChips(key){
      const panel = document.getElementById('fabricColors');
      const cfg = FABRIC_CONFIG[key]; if(!cfg) return;
      panel.innerHTML = cfg.colors.map(c=>{
        const isSelected = (state.fabricColorId===c.id && state.fabric===key);
        const selectedClass = isSelected ? ' selected' : '';
        const disabledClass = c.inStock ? '' : ' disabled';
        return `
          <button type="button"
            class="color-chip${selectedClass}${disabledClass}"
            data-fabric="${key}" data-color="${c.id}"
            ${c.inStock?'':'disabled'}
            role="radio" aria-checked="${isSelected?'true':'false'}"
            title="${cfg.labelEn} — ${c.labelEn}">
            <img src="${c.imageUrl}" alt="${c.labelEn}" />
          </button>`;
      }).join('');
      panel.querySelectorAll('.color-chip').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          if(btn.disabled) return;
          selectFabricColor(btn.dataset.fabric, btn.dataset.color);
        });
      });
    }

    function selectFabricColor(fabricKey, colorId){
      const cfg = FABRIC_CONFIG[fabricKey]; if(!cfg) return;
      const color = cfg.colors.find(c=>c.id===colorId && c.inStock); if(!color) return;

      const panel = document.getElementById('fabricColors');
      panel.querySelectorAll('.color-chip').forEach(btn=>{
        const on = (btn.dataset.color===colorId);
        btn.classList.toggle('selected', on);
        btn.setAttribute('aria-checked', on?'true':'false');
      });

      state.fabric = fabricKey;
      state.fabricEn = cfg.labelEn;
      state.fabricColorId = colorId;
      state.fabricColor = color.labelEn;

      updateFabricSelectionNote();
      refreshStep3Controls();
    }

    function updateFabricSelectionNote(){
      const n = document.getElementById('fabricSelectionNote');
      if(state.fabricEn && state.fabricColor) n.textContent = `${state.fabricEn} — ${state.fabricColor}`;
      else n.textContent = '';
    }
    function refreshStep3Controls(){
      const next = document.getElementById('nextS3');
      if(next) next.disabled = !(state.fabric && state.fabricColor);
    }

    /* ===== Step 4: 설정/로직 ===== */
    const LACE_CONFIG = {
      Lace: {
        id: 'Lace', labelEn: 'Lace',
        colors: [
          { id: 'white', labelEn: 'White', imageUrl: 'images/lace-white.jpg?v=2', inStock: true },
          { id: 'black', labelEn: 'Black', imageUrl: 'images/lace-black.jpg?v=2', inStock: true }
        ]
      },
      FabricLace: {
        id: 'FabricLace', labelEn: 'Fabric Lace',
        colors: [
          { id: 'white_satin',     labelEn: 'White Satin',      imageUrl: 'images/satin-white.jpg?v=2', inStock: true },
          { id: 'black_satin',     labelEn: 'Black Satin',      imageUrl: 'images/satin-black.jpg?v=2', inStock: true },
          { id: 'skyblue_satin',   labelEn: 'Sky Blue Satin',   imageUrl: 'images/satin-skyblue.jpg?v=2', inStock: true },
          { id: 'lightpink_satin', labelEn: 'Light Pink Satin', imageUrl: 'images/satin-lightpink.jpg?v=2', inStock: true }
        ]
      }
    };

   function selectLace(key, el){
  // ① 먼저 정리
  resetChipsWrap('laceGrid','laceColors');

  // ② 상태/선택 표시
  const grid = document.getElementById('laceGrid');
  [...grid.querySelectorAll('.option')].forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');

  state.laceType    = key;
  state.lace        = LACE_CONFIG[key]?.labelEn || key;
  state.laceColor   = '';
  state.laceColorId = '';

  // ③ 칩 HTML 렌더만 (표시/숨김 X)
  renderLaceChips(key);

  // ④ 오른쪽 부착 + 표시
  const panel = document.getElementById('laceColors');
  attachChipsRight(el, panel);

  updateLaceSelectionNote();
  refreshStep4Controls();
}

    function renderLaceChips(key){
      const panel = document.getElementById('laceColors');
      const cfg = LACE_CONFIG[key]; if(!cfg) return;
      panel.innerHTML = cfg.colors.map(c=>{
        const isSelected = (state.laceColorId===c.id && state.laceType===key);
        const selectedClass = isSelected ? ' selected' : '';
        const disabledClass = c.inStock ? '' : ' disabled';
        return `
          <button type="button"
            class="color-chip${selectedClass}${disabledClass}"
            data-lace="${key}" data-color="${c.id}"
            ${c.inStock?'':'disabled'}
            role="radio" aria-checked="${isSelected?'true':'false'}"
            title="${cfg.labelEn} — ${c.labelEn}">
            <img src="${c.imageUrl}" alt="${c.labelEn}" />
          </button>`;
      }).join('');
      panel.querySelectorAll('.color-chip').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          if(btn.disabled) return;
          selectLaceColor(btn.dataset.lace, btn.dataset.color);
        });
      });
    }

    function selectLaceColor(laceKey, colorId){
      const cfg = LACE_CONFIG[laceKey]; if(!cfg) return;
      const color = cfg.colors.find(c=>c.id===colorId && c.inStock); if(!color) return;

      const panel = document.getElementById('laceColors');
      panel.querySelectorAll('.color-chip').forEach(btn=>{
        const on = (btn.dataset.color===colorId);
        btn.classList.toggle('selected', on);
        btn.setAttribute('aria-checked', on?'true':'false');
      });

      state.laceType = laceKey;
      state.lace     = cfg.labelEn;
      state.laceColorId = colorId;
      state.laceColor   = color.labelEn;

      updateLaceSelectionNote();
      refreshStep4Controls();
    }

    function updateLaceSelectionNote(){
      const n = document.getElementById('laceSelectionNote');
      if(state.lace && state.laceColor) n.textContent = `${state.lace} — ${state.laceColor}`;
      else n.textContent = '';
    }
    function refreshStep4Controls(){
      const next = document.getElementById('nextS4');
      if(next) next.disabled = !(state.lace && state.laceColor);
    }

    /* ===== Step 7 요약 ===== */
    function renderSummary(){
      const s = document.getElementById('summary');
      s.innerHTML = `
        <div><b>Shape:</b> ${state.shape}</div>
        <div><b>Fabric:</b> ${state.fabricEn || state.fabric} — ${state.fabricColor}</div>
        <div><b>Lace:</b> ${state.lace} — ${state.laceColor}</div>
        <div><b>Cubic Keyword:</b> "${escapeHTML(state.keyword)}"</div>
        <div><b>Cubic Color:</b> ${state.cubicColor}</div>
      `;
      const err = document.getElementById('submitError');
      err.style.display='none'; err.textContent='';
    }

    /* ===== 제출 ===== */
    async function submitForm(){
      const btn=document.getElementById('submitBtn');
      const errBox=document.getElementById('submitError');
      btn.disabled=true; btn.textContent='…';
      errBox.style.display='none'; errBox.textContent='';

      try{
        const fd = new FormData();
        fd.append('name', state.name);
        fd.append('phone', state.phone);
        fd.append('xid', state.xid);
        fd.append('privacy', state.privacy ? 'Y' : 'N');
        fd.append('shape', state.shape);
        // 원단/레이스(추가 필드 - 시트가 받지 않더라도 무해)
        fd.append('fabric', state.fabricEn || state.fabric || '');
        fd.append('fabricColor', state.fabricColor || '');
        fd.append('lace', state.lace || '');
        fd.append('laceColor', state.laceColor || '');
        // 키워드/큐빅색
        fd.append('keyword', state.keyword);
        fd.append('color', state.cubicColor); // 기존 스키마 유지: Cubic Color
        fd.append('userAgent', navigator.userAgent);

        const res = await fetch(WEB_APP_URL, { method:'POST', body: fd });
        const text = await res.text();
        let data; try { data = JSON.parse(text); } catch(e){ data = null; }

        if(!res.ok || !data || data.ok !== true){
          const reason = (data && (data.error || JSON.stringify(data))) || text || (`HTTP ${res.status}`);
          throw new Error(reason);
        }

        const rn = data.reservationNumber || 'PREPARING';

        document.getElementById('doneText').textContent =
        `${state.name}, your reservation number is ${rn}`;

        renderReceipt({
            mountId:'receiptFinal',
            name: state.name,
            reservationNumber: rn,         // ← 예약번호 반영
            date: new Date(),
            shape: state.shape,
            fabric: state.fabricEn || state.fabric,
            fabricColor: state.fabricColor,
            lace: state.lace,
            laceColor: state.laceColor,
            keyword: state.keyword,
            cubicColor: state.cubicColor
        });
        show(8);

      }catch(err){
        errBox.textContent = 'Submit failed: ' + err.message;
        errBox.style.display='block';
        btn.disabled=false; btn.textContent='✓';
      }
    }

    /* ===== 헤더 자동 분리 (Step X / 설명) ===== */
    document.querySelectorAll('.step h2').forEach(h2 => {
      const parts = h2.textContent.split(':');
      if (parts.length === 2) {
        const stepNum = parts[0].trim();   // "Step 1"
        const stepDesc = parts[1].trim();  // "..."
        h2.innerHTML = `
          <span class="step-num">${stepNum}</span>
          <span class="step-desc">${stepDesc}</span>
        `;
      }
    });
    // HTML 이스케이프 함수
  function escapeHTML(str){
    return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
  }
  // 날짜 포맷
  function formatDateK(dt){
    const d = new Date(dt);
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const ddd = days[d.getDay()];
    return `${yyyy}.${mm}.${dd} (${ddd})`;
  }

  // 영수증 렌더링
  function renderReceipt({mountId, name, reservationNumber, date, shape, fabric, fabricColor, lace, laceColor, keyword, cubicColor}){
    const mount = document.getElementById(mountId);
    if(!mount) return;
    const hasLogo = !!LOGO_URL;
    const rn = reservationNumber || 'PREPARING';
    const barcodeUrl = "https://via.placeholder.com/300x80?text=BARCODE";
    const dateStr = formatDateK(date);
    const rows = [
      ['Shape', escapeHTML(shape||'-')],
      ['Fabric', `${escapeHTML(fabric||'-')}${fabricColor ? ' — '+escapeHTML(fabricColor):''}`],
      // ✅ Lace만 2줄(오른쪽 정렬)로 출력
      ['Lace', `
        <div class="val-multi">
          <div class="top">${escapeHTML(lace || '-')}</div>
          <div class="bottom">${laceColor ? escapeHTML(laceColor) : ''}</div>
        </div>
      `],
      ['Cubic keyword', `"${escapeHTML(keyword||'-')}"`],
      ['Cubic color', escapeHTML(cubicColor||'-')]
    ];
    mount.innerHTML = `
      <div class="receipt-card">
        <div class="rc-header rc-header--center">
          ${hasLogo ? `<img class="rc-logo rc-logo--big" src="${LOGO_URL}" alt="Brand logo" />`
          : `<div class="rc-logo rc-logo--big ph">LOGO</div>`}
        <div class="rc-thanks">${THANKS_HEADER}</div>
      </div>
        <div class="rc-sep"></div>
        <div class="rc-info">
          <div class="rc-info-row"><span class="l">Name</span><span class="r">${escapeHTML(name||'-')}</span></div>
          <div class="rc-info-row"><span class="l">Date</span><span class="r">${dateStr}</span></div>
          <div class="rc-info-row"><span class="l">Reservation No.</span><span class="r monospace">${escapeHTML(rn)}</span></div>
        </div>
        <div class="rc-sep dotted"></div>
        <div class="rc-items">
          ${rows.map(([l,v])=>`<div class="rc-item"><span class="l">${l}</span><span class="r monospace">${v}</span></div>`).join('')}
        </div>
        <div class="rc-sep"></div>
        <div class="rc-barcode">
          <img src="https://via.placeholder.com/320x80?text=BARCODE" alt="Barcode"/>
          <div class="rc-serial monospace">${escapeHTML(rn)}</div>
        </div>
        <div class="rc-sep dotted"></div>
        <div class="rc-footer">
          <div class="rc-note">Thank you for your reservation.</div>
          <div class="rc-sns">Follow us: @givemelove_official · instagram.com/givemelove_official</div>
        </div>
      </div>`;
  }
// 1) 기존 chips-row 래퍼를 해제하고, 패널을 그리드 뒤로 돌려놓고 숨김
function resetChipsWrap(gridId, panelId){
  const grid  = document.getElementById(gridId);
  const panel = document.getElementById(panelId);
  if(!grid || !panel) return;

  // chips-row 해제 (카드 되돌리기)
  grid.querySelectorAll('.chips-row').forEach(w=>{
    const opt = w.querySelector('.option');
    if (opt) grid.insertBefore(opt, w);
    w.remove();
  });

  // 패널을 그리드 바로 다음으로 이동
  if (panel.parentNode !== grid.parentNode || panel.previousElementSibling !== grid){
    grid.parentNode.insertBefore(panel, grid.nextSibling);
  }

  // 확실히 숨김
  panel.classList.add('hidden');
  panel.style.removeProperty('display');
}

// 2) 선택 카드 오른쪽으로 패널을 부착하고 "표시"만 여기서 담당
function attachChipsRight(el, panel){
  if(!el || !panel) return;

  // 이미 chips-row라면 패널만 옮기기, 아니면 래퍼 새로 만들기
  if (el.parentElement && el.parentElement.classList.contains('chips-row')) {
    el.parentElement.appendChild(panel);
  } else {
    const wrap = document.createElement('div');
    wrap.className = 'chips-row';
    el.parentNode.insertBefore(wrap, el);
    wrap.appendChild(el);
    wrap.appendChild(panel);
  }

  // 반드시 보이도록 (hidden 제거 + display 인라인 제거)
  panel.classList.remove('hidden');
  panel.style.removeProperty('display');
}

    // 초기화
    show(1);
  </script>
</body>
</html>

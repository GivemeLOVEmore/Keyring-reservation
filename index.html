<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Give me LOVE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Î∂ÑÎ¶¨Îêú CSS -->
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Moirai+One&display=swap" rel="stylesheet">
</head>
</head>
<body>
  <h1>Give me LOVE</h1>
  <p class="subtitle">Make a custom filled with love.</p>

  <!-- Step 1 -->
  <div class="step" id="s1">
    <h2>Step 1: Personal Information (required)</h2>
    <div class="row"><input id="name" type="text" placeholder="Name" /></div>
    <div class="row"><input id="phone" type="text" placeholder="Phone Number" /></div>
    <div class="row"><input id="xid" type="text" placeholder="X ID" /></div>
    <div class="row">
      <label><input id="privacy" type="checkbox" /> I agree to provide my personal information (required)</label>
    </div>
    <div class="actions">
      <span></span>
      <button class="circle-btn next" onclick="go(2)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="step hidden" id="s2">
    <h2>Step 2: Pick your favorite keyring shape</h2>
    <div class="grid">
      <div class="option" data-value="Heart" onclick="pick('shape', this)">
        <img src="https://via.placeholder.com/150?text=Heart" alt="Heart" /><div>Heart</div>
      </div>
      <div class="option" data-value="Round" onclick="pick('shape', this)">
        <img src="https://via.placeholder.com/150?text=Round" alt="Round" /><div>Round</div>
      </div>
      <div class="option" data-value="Rectangle" onclick="pick('shape', this)">
        <img src="https://via.placeholder.com/150?text=Rectangle" alt="Rectangle" /><div>Rectangle</div>
      </div>
    </div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(1)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(3)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

<!-- Step 3 -->
<div class="step hidden" id="s3">
  <h2>Step 3: Fabric & Color</h2>

  <!-- Ïû¨Ïßà ÏÑ†ÌÉù (Í∑∏Î¶º/Ïπ¥Îìú) -->
  <div class="grid" id="fabricGrid">
    <!-- Ïû¨Ïßà Ïπ¥ÎìúÎäî Í∑∏ÎåÄÎ°ú ÎëêÏñ¥ÎèÑ OK. ÌÅ¥Î¶≠ Ïãú selectFabric Ìò∏Ï∂ú -->
    <div class="option" data-value="Satin" onclick="selectFabric('Satin', this)">
      <img src="https://via.placeholder.com/150?text=Satin" alt="Satin" /><div>Satin</div>
    </div>
    <div class="option" data-value="Leopard" onclick="selectFabric('Leopard', this)">
      <img src="https://via.placeholder.com/150?text=Leopard" alt="Leopard" /><div>Leopard</div>
    </div>
  </div>

  <!-- ÏÉâÏÉÅ Ïπ© Ìå®ÎÑê (Ïû¨Ïßà ÏÑ†ÌÉù ÌõÑ ÎÖ∏Ï∂ú) -->
  <div id="fabricColors" class="color-chips hidden" role="radiogroup" aria-label="Fabric colors"></div>

  <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò: Back / (ÏÑ†ÌÉù Í≤∞Í≥º) / Next -->
  <div class="actions">
    <button class="circle-btn back" onclick="back(2)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>

    <!-- ÏÑ†ÌÉù ÏöîÏïΩ Î¨∏Íµ¨(ÏòÅÎ¨∏, Ïù¥ÌÉ§Î¶≠, Î≥∏Î¨∏ÏÉâ) -->
    <div id="fabricSelectionNote" class="step-selection-note"></div>

    <button class="circle-btn next" id="nextS3" onclick="go(4)" aria-label="Next" disabled>
      ‚Üí<span class="sr-only">Next</span>
    </button>
  </div>
</div>


<!-- Step 4 -->
<div class="step hidden" id="s4">
  <h2>Step 4: Lace & Color</h2>

  <!-- Î†àÏù¥Ïä§ ÌÉÄÏûÖ ÏÑ†ÌÉù -->
  <div class="grid" id="laceGrid">
    <div class="option" data-value="Lace" onclick="selectLace('Lace', this)">
      <img src="https://via.placeholder.com/150?text=Lace" alt="Lace" /><div>Lace</div>
    </div>
    <div class="option" data-value="FabricLace" onclick="selectLace('FabricLace', this)">
      <img src="https://via.placeholder.com/150?text=Fabric+Lace" alt="Fabric Lace" /><div>Fabric Lace</div>
    </div>
  </div>

  <!-- ÏÉâÏÉÅ Ïπ© (Î†àÏù¥Ïä§ ÏÑ†ÌÉù ÌõÑ ÎÖ∏Ï∂ú) -->
  <div id="laceColors" class="color-chips hidden" role="radiogroup" aria-label="Lace colors"></div>

  <!-- ÎÑ§ÎπÑ: Back / ÏÑ†ÌÉùÏöîÏïΩ / Next -->
  <div class="actions">
    <button class="circle-btn back" onclick="back(3)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
    <div id="laceSelectionNote" class="step-selection-note"></div>
    <button class="circle-btn next" id="nextS4" onclick="go(5)" aria-label="Next" disabled>
      ‚Üí<span class="sr-only">Next</span>
    </button>
  </div>
</div>


  <!-- Step 5 -->
  <div class="step hidden" id="s5">
    <h2>Step 5: Type in your custom keyword</h2>
    <div class="row"><input id="keyword" type="text" class="text" placeholder='e.g., "Give me LOVE"' /></div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(4)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(6)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 6 -->
  <div class="step hidden" id="s6">
    <h2>Step 6: Choose your cubic color</h2>
    <div class="grid">
      <div class="option" data-value="Black" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/000000/FFFFFF?text=Black" alt="Black" /><div>Black</div>
      </div>
      <div class="option" data-value="Clear" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/FFFFFF/000000?text=Clear" alt="Clear" /><div>Clear</div>
      </div>
      <div class="option" data-value="Pink" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/FFC0CB/000000?text=Pink" alt="Pink" /><div>Pink</div>
      </div>
      <div class="option" data-value="Sky Blue" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/87CEEB/000000?text=Sky+Blue" alt="Sky Blue" /><div>Sky Blue</div>
      </div>
    </div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(5)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(7)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 7 -->
  <div class="step hidden" id="s7">
    <h2>Step 7: Review your choices and confirm</h2>
    <div id="summary"></div>
    <div class="error" id="submitError" style="display:none;"></div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(6)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" id="submitBtn" onclick="submitForm()" aria-label="Submit">‚úì<span class="sr-only">Submit</span></button>
    </div>
  </div>

  <!-- Step 8 -->
  <div class="step hidden" id="s8">
    <h2>Your reservation is complete ‚Äì thank you!</h2>
    <p id="doneText"></p>
  </div>

  <script>
    // ‚Üê Ïó¨Í∏∞ Ìïú Ï§ÑÎßå ÎÑ§ "Web app URL"Î°ú Î∞îÍæ∏Î©¥ ÏôÑÎ£å!
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzDmUw-P8BeIdqE9eSW9uMGTJtQxuUnzTrmIA9DjRhAaVZ_2SA7sov_8wjfNL-HwjFj8Q/exec';

    const state = { name:'', phone:'', xid:'', privacy:false, shape:'', fabric:'', lace:'', keyword:'', color:'' };

    function go(step){
      if(step===2){
        state.name = document.getElementById('name').value.trim();
        state.phone = document.getElementById('phone').value.trim();
        state.xid = document.getElementById('xid').value.trim();
        state.privacy = document.getElementById('privacy').checked;
        if(!state.name || !state.phone || !state.xid || !state.privacy){
          alert('Please complete all required fields and check the privacy agreement.');
          return;
        }
      }
      if(step===7){
        state.keyword = document.getElementById('keyword').value.trim();
        if(!state.shape || !state.fabric || !state.lace || !state.color || !state.keyword){
          alert('Please complete all selections.');
          return;
        }
        renderSummary();
      }
      show(step);
    }
    function back(step){ show(step); }
    function show(step){ for(let i=1;i<=8;i++){ const el=document.getElementById('s'+i); if(el) el.classList.toggle('hidden', i!==step); } }
    function pick(key, el){ const parent=el.parentElement; [...parent.querySelectorAll('.option')].forEach(o=>o.classList.remove('selected')); el.classList.add('selected'); state[key]=el.dataset.value; }
    function renderSummary(){
      document.getElementById('summary').innerHTML = `
        <div><b>Shape:</b> ${state.shape}</div>
        <div><b>Fabric:</b> ${state.fabric}</div>
        <div><b>Lace:</b> ${state.lace}</div>
        <div><b>Cubic Keyword:</b> "${state.keyword}"</div>
        <div><b>Cubic Color:</b> ${state.color}</div>
      `;
      document.getElementById('submitError').style.display='none';
      document.getElementById('submitError').textContent='';
    }

    // üîë FormDataÎ°ú POST
    async function submitForm(){
      const btn=document.getElementById('submitBtn');
      const errBox=document.getElementById('submitError');
      btn.disabled=true; btn.textContent='‚Ä¶';
      errBox.style.display='none'; errBox.textContent='';

      try{
        const fd = new FormData();
        fd.append('name', state.name);
        fd.append('phone', state.phone);
        fd.append('xid', state.xid);
        fd.append('privacy', state.privacy ? 'Y' : 'N');
        fd.append('shape', state.shape);
        fd.append('fabric', state.fabric);
        fd.append('lace', state.lace);
        fd.append('keyword', state.keyword);
        fd.append('color', state.color);
        fd.append('userAgent', navigator.userAgent);

        const res = await fetch(WEB_APP_URL, { method:'POST', body: fd });
        const text = await res.text();
        let data; try { data = JSON.parse(text); } catch(e){ data = null; }

        if(!res.ok || !data || data.ok !== true){
          const reason = (data && (data.error || JSON.stringify(data))) || text || (`HTTP ${res.status}`);
          throw new Error(reason);
        }

        document.getElementById('doneText').textContent =
          `${state.name}, your reservation number is: ${data.reservationNumber}`;
        show(8);

      }catch(err){
        errBox.textContent = 'Submit failed: ' + err.message;
        errBox.style.display='block';
        btn.disabled=false; btn.textContent='‚úì';
      }
    }

    show(1);
    
  // Step Ìó§Îçî ÏûêÎèô Î≥ÄÌôò
  document.querySelectorAll('.step h2').forEach(h2 => {
    const parts = h2.textContent.split(':');
    if (parts.length === 2) {
      const stepNum = parts[0].trim();   // "Step 1"
      const stepDesc = parts[1].trim();  // "Personal Information (required)"
      h2.innerHTML = `
        <span class="step-num">${stepNum}</span>
        <span class="step-desc">${stepDesc}</span>
      `;
    }
  });
   const FABRIC_CONFIG = {
    Satin: {
      id: 'Satin',
      labelEn: 'Satin',
      imageUrl: 'https://via.placeholder.com/150?text=Satin',
      colors: [
        { id: 'white',   labelEn: 'White',    imageUrl: 'https://via.placeholder.com/64/FFFFFF/000000?text= ', inStock: true  },
        { id: 'skyblue', labelEn: 'Sky Blue', imageUrl: 'https://via.placeholder.com/64/87CEEB/000000?text= ', inStock: true  },
        { id: 'lpink',   labelEn: 'Light Pink', imageUrl: 'https://via.placeholder.com/64/FFC0CB/000000?text= ', inStock: true }
      ]
    },
    Leopard: {
      id: 'Leopard',
      labelEn: 'Leopard',
      imageUrl: 'https://via.placeholder.com/150?text=Leopard',
      colors: [
        { id: 'default', labelEn: 'Default', imageUrl: 'https://via.placeholder.com/64/D2B48C/000000?text=L', inStock: true },
        { id: 'pink',    labelEn: 'Pink',    imageUrl: 'https://via.placeholder.com/64/FFC0CB/000000?text=L', inStock: true },
        { id: 'khaki',   labelEn: 'Khaki',   imageUrl: 'https://via.placeholder.com/64/6B8E23/000000?text=L', inStock: true }
      ]
    }
  };

  /** Ïû¨Ïßà ÏÑ†ÌÉù */
  function selectFabric(fabricKey, el) {
    // Ïπ¥Îìú ÏÑ†ÌÉù ÌëúÏãú
    const grid = document.getElementById('fabricGrid');
    [...grid.querySelectorAll('.option')].forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');

    // ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî & Ï†ÄÏû•
    state.fabric = fabricKey;
    state.color  = ''; // Ïû¨Ïßà Î∞îÍæ∏Î©¥ ÏÉâÏÉÅ Î¶¨ÏÖã

    // ÏÉâÏÉÅ Ïπ© Î†åÎçîÎßÅ
    renderColorChips(fabricKey);

    // ÏÑ†ÌÉù ÏöîÏïΩ Î¨∏Íµ¨/Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏóÖÎç∞Ïù¥Ìä∏
    updateSelectionNote();
    refreshStep3Controls();
  }

  /** ÏÉâÏÉÅ Ïπ© Î†åÎçîÎßÅ */
  function renderColorChips(fabricKey) {
    const panel = document.getElementById('fabricColors');
    const cfg = FABRIC_CONFIG[fabricKey];
    if (!cfg) return;

    panel.innerHTML = cfg.colors.map(c => {
      const disabledClass = c.inStock ? '' : ' disabled';
      // ÏÑ†ÌÉù ÏÉÅÌÉú
      const isSelected = (state.colorId === c.id && state.fabric === fabricKey);
      const selectedClass = isSelected ? ' selected' : '';

      return `
        <button
          type="button"
          class="color-chip${selectedClass}${disabledClass}"
          data-fabric="${fabricKey}"
          data-color="${c.id}"
          ${c.inStock ? '' : 'disabled'}
          role="radio"
          aria-checked="${isSelected ? 'true' : 'false'}"
          title="${cfg.labelEn} ‚Äî ${c.labelEn}"
        >
          <img src="${c.imageUrl}" alt="${c.labelEn}" />
        </button>
      `;
    }).join('');

    panel.classList.remove('hidden');

    // Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îî©
    panel.querySelectorAll('.color-chip').forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.disabled) return;
        const fabric = btn.dataset.fabric;
        const colorId = btn.dataset.color;
        selectColor(fabric, colorId);
      });
    });
  }

  /** ÏÉâÏÉÅ ÏÑ†ÌÉù (Îã®Ïùº ÏÑ†ÌÉù ÎùºÎîîÏò§ ÎèôÏûë) */
  function selectColor(fabricKey, colorId) {
    const cfg = FABRIC_CONFIG[fabricKey];
    if (!cfg) return;
    const color = cfg.colors.find(c => c.id === colorId);
    if (!color || !color.inStock) return;

    // Ïπ© ÏÑ†ÌÉù ÏÉÅÌÉú ÌÜ†Í∏Ä
    const panel = document.getElementById('fabricColors');
    panel.querySelectorAll('.color-chip').forEach(btn => {
      const on = (btn.dataset.color === colorId);
      btn.classList.toggle('selected', on);
      btn.setAttribute('aria-checked', on ? 'true' : 'false');
    });

    // ÏÉÅÌÉú Ï†ÄÏû•(ÏöîÏïΩ/Ï†ÑÏÜ°Ïö©)
    state.fabric   = fabricKey;                // 'Satin' | 'Leopard'
    state.colorId  = colorId;                  // 'white' | ...
    state.color    = color.labelEn;            // 'White' | ...
    state.fabricEn = cfg.labelEn;              // 'Satin' | 'Leopard'

    updateSelectionNote();
    refreshStep3Controls();
  }

  /** Back‚ÄìNext ÏÇ¨Ïù¥ ÏÑ†ÌÉù ÏöîÏïΩ ÌëúÏãú (ÏòÅÎ¨∏, Ïù¥ÌÉ§Î¶≠, Î≥∏Î¨∏ÏÉâ) */
  function updateSelectionNote() {
    const note = document.getElementById('fabricSelectionNote');
    if (state.fabric && state.color) {
      const fabricLabel = state.fabricEn || state.fabric;
      const colorLabel  = state.color;
      note.textContent = `${fabricLabel} ‚Äî ${colorLabel}`;
    } else {
      note.textContent = '';
    }
  }

  /** Step 3ÏóêÏÑúÎßå Next Î≤ÑÌäº ÌôúÏÑ±/ÎπÑÌôúÏÑ± */
  function refreshStep3Controls() {
    const nextBtn = document.getElementById('nextS3');
    if (!nextBtn) return;
    // ÏÉâÏÉÅ ÏÑ†ÌÉù Ï†ÑÏóêÎäî ÎπÑÌôúÏÑ±Ìôî
    const ok = !!(state.fabric && state.color);
    nextBtn.disabled = !ok;
  }

  /** ÏïàÏ†ÑÏû•Ïπò: Step 3 ÏôÑÎ£å ÏöîÍ±¥ ÏóÜÏúºÎ©¥ 4Î°ú Î™ª ÎÑòÏñ¥Í∞ÄÍ≤å */
  const _goOrig = go; // Í∏∞Ï°¥ go Î≥¥Ï°¥
  go = function(step) {
    if (step === 4) {
      // Ïû¨Ïßà+ÏÉâÏÉÅ ÌïÑÏàò
      if (!state.fabric || !state.color) {
        // Î≤ÑÌäºÏùÄ ÎπÑÌôúÏÑ± Ï≤òÎ¶¨ÎêòÏñ¥ ÏûàÏúºÎØÄÎ°ú Î≥¥ÌÜµ ÎèÑÎã¨ Ïïà Ìï®.
        return; // Ï°∞Ïö©Ìûà Î¨¥Ïãú
      }
    }
    _goOrig(step);
    // ÌôîÎ©¥ Ï†ÑÌôò ÌõÑ Step3 Ïª®Ìä∏Î°§ Í∞±Ïã†
    if (step === 3) refreshStep3Controls();
  };  
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Give me LOVE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Î∂ÑÎ¶¨Îêú CSS -->
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Moirai+One&display=swap" rel="stylesheet">
</head>
</head>
<body>
  <h1>Give me LOVE</h1>
  <p class="subtitle">Make a custom filled with love.</p>

  <!-- Step 1 -->
  <div class="step" id="s1">
    <h2>
      <span class="step-num">Step 1</span>
      <span class="step-desc">Personal Information (required)</span>
    </h2>
    <div class="row"><input id="name" type="text" placeholder="Name" /></div>
    <div class="row"><input id="phone" type="text" placeholder="Phone Number" /></div>
    <div class="row"><input id="xid" type="text" placeholder="X ID" /></div>
    <div class="row">
      <label><input id="privacy" type="checkbox" /> I agree to provide my personal information (required)</label>
    </div>
    <div class="actions">
      <span></span>
      <button class="circle-btn next" onclick="go(2)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="step hidden" id="s2">
    <h2>Step 2: Choose Keyring Shape</h2>
    <div class="grid">
      <div class="option" data-value="Heart" onclick="pick('shape', this)">
        <img src="https://via.placeholder.com/150?text=Heart" alt="Heart" /><div>Heart</div>
      </div>
      <div class="option" data-value="Round" onclick="pick('shape', this)">
        <img src="https://via.placeholder.com/150?text=Round" alt="Round" /><div>Round</div>
      </div>
      <div class="option" data-value="Rectangle" onclick="pick('shape', this)">
        <img src="https://via.placeholder.com/150?text=Rectangle" alt="Rectangle" /><div>Rectangle</div>
      </div>
    </div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(1)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(3)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 3 -->
  <div class="step hidden" id="s3">
    <h2>Step 3: Choose Fabric</h2>
    <div class="grid">
      <div class="option" data-value="Satin" onclick="pick('fabric', this)">
        <img src="https://via.placeholder.com/150?text=Satin" alt="Satin" /><div>Satin</div>
      </div>
      <div class="option" data-value="Leopard" onclick="pick('fabric', this)">
        <img src="https://via.placeholder.com/150?text=Leopard" alt="Leopard" /><div>Leopard</div>
      </div>
    </div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(2)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(4)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 4 -->
  <div class="step hidden" id="s4">
    <h2>Step 4: Choose Lace</h2>
    <div class="grid">
      <div class="option" data-value="Lace" onclick="pick('lace', this)">
        <img src="https://via.placeholder.com/150?text=Lace" alt="Lace" /><div>Lace</div>
      </div>
      <div class="option" data-value="Fabric Lace" onclick="pick('lace', this)">
        <img src="https://via.placeholder.com/150?text=Fabric+Lace" alt="Fabric Lace" /><div>Fabric Lace</div>
      </div>
    </div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(3)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(5)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 5 -->
  <div class="step hidden" id="s5">
    <h2>Step 5: Cubic Keyword</h2>
    <div class="row"><input id="keyword" type="text" class="text" placeholder='e.g., "Give me LOVE"' /></div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(4)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(6)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 6 -->
  <div class="step hidden" id="s6">
    <h2>Step 6: Cubic Color</h2>
    <div class="grid">
      <div class="option" data-value="Black" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/000000/FFFFFF?text=Black" alt="Black" /><div>Black</div>
      </div>
      <div class="option" data-value="Clear" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/FFFFFF/000000?text=Clear" alt="Clear" /><div>Clear</div>
      </div>
      <div class="option" data-value="Pink" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/FFC0CB/000000?text=Pink" alt="Pink" /><div>Pink</div>
      </div>
      <div class="option" data-value="Sky Blue" onclick="pick('color', this)">
        <img src="https://via.placeholder.com/150/87CEEB/000000?text=Sky+Blue" alt="Sky Blue" /><div>Sky Blue</div>
      </div>
    </div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(5)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" onclick="go(7)" aria-label="Next">‚Üí<span class="sr-only">Next</span></button>
    </div>
  </div>

  <!-- Step 7 -->
  <div class="step hidden" id="s7">
    <h2>Step 7: Review & Submit</h2>
    <div id="summary"></div>
    <div class="error" id="submitError" style="display:none;"></div>
    <div class="actions">
      <button class="circle-btn back" onclick="back(6)" aria-label="Back">‚Üê<span class="sr-only">Back</span></button>
      <button class="circle-btn next" id="submitBtn" onclick="submitForm()" aria-label="Submit">‚úì<span class="sr-only">Submit</span></button>
    </div>
  </div>

  <!-- Step 8 -->
  <div class="step hidden" id="s8">
    <h2>Thank you!</h2>
    <p id="doneText"></p>
  </div>

  <script>
    // ‚Üê Ïó¨Í∏∞ Ìïú Ï§ÑÎßå ÎÑ§ "Web app URL"Î°ú Î∞îÍæ∏Î©¥ ÏôÑÎ£å!
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzDmUw-P8BeIdqE9eSW9uMGTJtQxuUnzTrmIA9DjRhAaVZ_2SA7sov_8wjfNL-HwjFj8Q/exec';

    const state = { name:'', phone:'', xid:'', privacy:false, shape:'', fabric:'', lace:'', keyword:'', color:'' };

    function go(step){
      if(step===2){
        state.name = document.getElementById('name').value.trim();
        state.phone = document.getElementById('phone').value.trim();
        state.xid = document.getElementById('xid').value.trim();
        state.privacy = document.getElementById('privacy').checked;
        if(!state.name || !state.phone || !state.xid || !state.privacy){
          alert('Please complete all required fields and check the privacy agreement.');
          return;
        }
      }
      if(step===7){
        state.keyword = document.getElementById('keyword').value.trim();
        if(!state.shape || !state.fabric || !state.lace || !state.color || !state.keyword){
          alert('Please complete all selections.');
          return;
        }
        renderSummary();
      }
      show(step);
    }
    function back(step){ show(step); }
    function show(step){ for(let i=1;i<=8;i++){ const el=document.getElementById('s'+i); if(el) el.classList.toggle('hidden', i!==step); } }
    function pick(key, el){ const parent=el.parentElement; [...parent.querySelectorAll('.option')].forEach(o=>o.classList.remove('selected')); el.classList.add('selected'); state[key]=el.dataset.value; }
    function renderSummary(){
      document.getElementById('summary').innerHTML = `
        <div><b>Shape:</b> ${state.shape}</div>
        <div><b>Fabric:</b> ${state.fabric}</div>
        <div><b>Lace:</b> ${state.lace}</div>
        <div><b>Cubic Keyword:</b> "${state.keyword}"</div>
        <div><b>Cubic Color:</b> ${state.color}</div>
      `;
      document.getElementById('submitError').style.display='none';
      document.getElementById('submitError').textContent='';
    }

    // üîë FormDataÎ°ú POST
    async function submitForm(){
      const btn=document.getElementById('submitBtn');
      const errBox=document.getElementById('submitError');
      btn.disabled=true; btn.textContent='‚Ä¶';
      errBox.style.display='none'; errBox.textContent='';

      try{
        const fd = new FormData();
        fd.append('name', state.name);
        fd.append('phone', state.phone);
        fd.append('xid', state.xid);
        fd.append('privacy', state.privacy ? 'Y' : 'N');
        fd.append('shape', state.shape);
        fd.append('fabric', state.fabric);
        fd.append('lace', state.lace);
        fd.append('keyword', state.keyword);
        fd.append('color', state.color);
        fd.append('userAgent', navigator.userAgent);

        const res = await fetch(WEB_APP_URL, { method:'POST', body: fd });
        const text = await res.text();
        let data; try { data = JSON.parse(text); } catch(e){ data = null; }

        if(!res.ok || !data || data.ok !== true){
          const reason = (data && (data.error || JSON.stringify(data))) || text || (`HTTP ${res.status}`);
          throw new Error(reason);
        }

        document.getElementById('doneText').textContent =
          `${state.name}, your reservation number is: ${data.reservationNumber}`;
        show(8);

      }catch(err){
        errBox.textContent = 'Submit failed: ' + err.message;
        errBox.style.display='block';
        btn.disabled=false; btn.textContent='‚úì';
      }
    }

    show(1);
  </script>
</body>
</html>
